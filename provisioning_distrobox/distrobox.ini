# Build once: holds the full image and tooling
[template]
image=fedora-toolbox:42
init=true
# unshare_all=true
unshare_netns=true
replace=true

# publish SSH and propagate the key-name env var
additional_flags="--env SSH_KEY_NAME=distrobox-key"

# provisioning volumes
volume="~/.ssh/distrobox-key.pub:/tmp/host-ssh-key/distrobox-key.pub:ro"
volume="~/Projects/devops/provisioning_distrobox/distrobox-init.sh:/tmp/container-init.sh:ro"

# run init script
init_hooks="/tmp/container-init.sh"

# assembly process
start_now=true

# -------------------------------------------------
# Fast-launch box: lightweight clone of the template
[container]
image=localhost/fedora-toolbox-template:latest # based on template
init=true
unshare_all=true
start_now=true

# you still need the runtime bits below (volumes, port, env)
additional_flags="--publish 2222:22"

# runtime volumes
volume="~/.claude/:$HOME/.claude/:rw"
volume="~/.claude.json:$HOME/.claude.json:rw"
volume="~/.claude.json.backup:$HOME/.claude.json.backup:rw"
volume="~/.gitconfig:$HOME/.gitconfig:rw"

# proj volumes
volume="./:$HOME/Projects/PROJECT_REPLACE_ME:rw"


# -------------------------------------------------
# Basic fedora container
[fedora]
image=fedora-toolbox:42

home=~/.distrobox/fedora-home
start_now=true

init_hooks="echo \"sudo ip link set dev wlp0s20f3 mtu 1360 # fix mtu issues, update iface\" > \$HOME/README.txt"

# -------------------------------------------------
# Ubuntu
[ubuntu]
image=ubuntu:24.04

# Required packages for Flatpak with systemd/dbus support
additional_packages="systemd dbus dbus-user-session libpam-systemd pipewire-audio-client-libraries"

init=true # enables systemd

home=~/.distrobox/ubuntu-home
start_now=true

# Setup SSH keys (do not start services during assemble)
init_hooks="mkdir -p \$HOME/.ssh && cp /var/home/user1/.ssh/authorized_keys \$HOME/.ssh/"
init_hooks="echo \"sudo ip link set dev wlp0s20f3 mtu 1360 # fix mtu issues, update iface\" > \$HOME/README.txt"

# -------------------------------------------------
# Ubuntu Games
[ubuntu-games]
image=ubuntu:24.04

home=~/.distrobox/ubuntu-home
start_now=true

# Setup SSH keys (do not start services during assemble)
init_hooks="echo \"sudo ip link set dev wlp0s20f3 mtu 1360 # fix mtu issues, update iface\" > \$HOME/README.txt"
# Install libssl1.1 for legacy .NET applications (like CARRION)
init_hooks="wget -q http://archive.ubuntu.com/ubuntu/pool/main/o/openssl/libssl1.1_1.1.0g-2ubuntu4_amd64.deb && sudo dpkg -i libssl1.1_1.1.0g-2ubuntu4_amd64.deb && rm -f libssl1.1_1.1.0g-2ubuntu4_amd64.deb"
